<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>Cadastro de Professor</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="topbar"><div class="title">Sistema Universidade</div></div>
  <main class="main">
    <section class="menu" aria-hidden="true"></section>
    <section class="formwrap">
      <a class="backbtn" href="index.html"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M15 18l-6-6 6-6" stroke="#0b5586" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>Voltar</a>

      <div class="formcard">
        <h2>Cadastro de Professor</h2>

        <div id="pfNaoExiste" class="message warn">A Pessoa Física informada não existe. Cadastre-a antes de continuar.</div>
        <div id="docPendentes" class="message warn">Documentos acadêmicos obrigatórios não enviados. Cadastro ficará PENDENTE.</div>
        <div id="matriculaDuplicada" class="message error">Matrícula funcional já existe. Vincule ou gere nova matrícula.</div>
        <div id="successMsg" class="message success">Professor cadastrado com sucesso! ID: <span id="idRetorno"></span></div>

        <form id="formProfessor" method="POST" action="/api/professores" class="form-grid">
          <div class="full">
            <label class="field">CPF da Pessoa Física *</label>
            <input class="input" id="cpf" name="cpf" required placeholder="Digite o CPF já cadastrado">
            <button type="button" class="cep-btn" id="btnBuscarPF" style="margin-top:10px">Buscar Pessoa Física</button>
          </div>

          <div>
            <label class="field">Titulação *</label>
            <select class="input" name="titulacao" required>
              <option value="">Selecione...</option><option value="Especialista">Especialista</option><option value="Mestre">Mestre</option><option value="Doutor">Doutor</option>
            </select>
          </div>

          <div>
            <label class="field">Área(s) de atuação *</label>
            <input class="input" name="areaAtuacao" required placeholder="Ex.: Sistemas, Redes">
          </div>

          <div>
            <label class="field">Vínculo *</label>
            <select class="input" name="vinculo" required><option value="">Selecione...</option><option value="efetivo">Efetivo</option><option value="contrato">Contrato</option></select>
          </div>

          <div>
            <label class="field">Matrícula Funcional *</label>
            <input class="input" id="matriculaFuncional" name="matriculaFuncional" required placeholder="Ex.: 2025-PROF-001">
          </div>

          <div class="full">
            <label class="field">Horários Disponíveis *</label>
            <textarea class="input" name="horarios" required placeholder="Ex.: Segunda 19h-22h, Quarta 14h-18h"></textarea>
          </div>

          <div class="full">
            <label class="field">Upload de Documentos Acadêmicos *</label>
            <input class="input" type="file" id="docUpload" accept=".pdf,.jpg,.png">
          </div>

          <div class="full"><button class="btn" type="submit">Salvar Cadastro</button></div>
        </form>
      </div>
    </section>
  </main>
  <footer class="footer">
	<div class="logo">
		<img src="https://www.ead.senac.br/public/assets/img/logo.png" 
			width="110" 
			height="32" 
			alt="Logo Senac">
	</div>
    <div class="credits">Equipe Projeto Integrador:<br>
		Anderson Chrispim da Silva<br>
		André Zicatti Leite<br>
		Diego Eiji de Menezes<br>
		Flavia R M Biagioni<br>
		Gustavo Lopes<br>
	</div>
   </footer>

<script src="form.js"></script>
<script>
// simulação busca PF
document.getElementById("btnBuscarPF").addEventListener("click", function(){
  const cpf = document.getElementById("cpf").value.trim();
  if(!cpf || cpf === "00000000000"){ document.getElementById("pfNaoExiste").style.display="block"; return; }
  document.getElementById("pfNaoExiste").style.display="none"; alert('Pessoa Física localizada.');
});

// submissão com simulação + envio real
document.getElementById("formProfessor").addEventListener("submit", async function(e){
  e.preventDefault();
  document.getElementById("matriculaDuplicada").style.display="none";
  document.getElementById("docPendentes").style.display="none";
  document.getElementById("successMsg").style.display="none";

  const matricula = document.getElementById("matriculaFuncional").value.trim();
  const docUpload = document.getElementById("docUpload").value;
  const form = e.target;

  if(matricula === "PROF-EXISTENTE"){ document.getElementById("matriculaDuplicada").style.display="block"; return; }
  if(!docUpload){ document.getElementById("docPendentes").style.display="block"; return; }

  const idFake = "PROF-" + Math.floor(Math.random()*90000 + 10000);
  document.getElementById("idRetorno").textContent = idFake;
  document.getElementById("successMsg").style.display="block";

  try{ await postForm(form, 'http://localhost:8080/api/professores'); }
  catch(err){ console.error('Erro envio prof', err); }

  form.reset();
});
</script>
</body>
</html>
