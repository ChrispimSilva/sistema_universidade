<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>Cadastro de Pessoa Jurídica</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="topbar"><div class="title">Sistema Universidade</div></div>
  <main class="main">
    <section class="menu" aria-hidden="true"></section>

    <section class="formwrap">
      <a class="backbtn" href="index.html">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M15 18l-6-6 6-6" stroke="#0b5586" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        Voltar
      </a>

      <div class="formcard">
        <h2>Cadastro de Pessoa Jurídica</h2>

        <div id="cnpjInvalido" class="message warn">CNPJ inválido ou não foi possível validar online. Cadastro será marcado como PENDENTE.</div>
        <div id="autoCadastroMsg" class="message warn">Auto cadastro detectado. Será enviado link de confirmação ao e-mail.</div>
        <div id="cnpjDuplicado" class="message error">CNPJ já cadastrado. Visualize ou solicite alteração.</div>
        <div id="successMsg" class="message success">Pessoa Jurídica cadastrada com sucesso! ID: <span id="idRetorno"></span></div>

        <form id="formPJ" method="POST" action="/api/pessoas/juridica" class="form-grid">
          <div class="full">
            <label class="field">Razão Social *</label>
            <input class="input" name="razaoSocial" required>
          </div>

          <div>
            <label class="field">Nome Fantasia *</label>
            <input class="input" name="nomeFantasia" required>
          </div>

          <div>
            <label class="field">CNPJ *</label>
            <input class="input" name="cnpj" id="cnpj" required placeholder="00.000.000/0000-00">
          </div>

          <div>
            <label class="field">Inscrição Estadual</label>
            <input class="input" name="inscricaoEstadual">
          </div>

          <div>
            <label class="field">Inscrição Municipal</label>
            <input class="input" name="inscricaoMunicipal">
          </div>

          <div class="full">
            <label class="field">Endereço Completo *</label>
            <textarea class="input" name="endereco" required></textarea>
          </div>

          <div>
            <label class="field">Contato Fiscal *</label>
            <input class="input" name="contatoFiscal" required placeholder="email@empresa.com">
          </div>

          <div>
            <label class="field">Auto cadastro?</label>
            <select class="input" id="autoCadastro" name="autoCadastro"><option value="nao">Não</option><option value="sim">Sim — Sou fornecedor</option></select>
          </div>

          <div class="full">
            <label class="field">Documentos Fiscais (URL / Observações)</label>
            <textarea class="input" name="documentosFiscais"></textarea>
          </div>

          <div class="full">
            <button class="btn" type="submit">Salvar</button>
          </div>
        </form>
      </div>
    </section>
  </main>

  <footer class="footer">
	<div class="logo">
		<img src="https://www.ead.senac.br/public/assets/img/logo.png" 
			width="110" 
			height="32" 
			alt="Logo Senac">
	</div>
    <div class="credits">Equipe Projeto Integrador:<br>
		Anderson Chrispim da Silva<br>
		André Zicatti Leite<br>
		Diego Eiji de Menezes<br>
		Flavia R M Biagioni<br>
		Gustavo Lopes<br>
	</div>
  </footer>

<script src="form.js"></script>
<script>
function cnpjEhValido(cnpj){ if(!cnpj) return false; if(cnpj.startsWith("00")) return false; return true; }

document.getElementById("formPJ").addEventListener("submit", async function(e){
  e.preventDefault();
  document.getElementById("cnpjInvalido").style.display="none";
  document.getElementById("autoCadastroMsg").style.display="none";
  document.getElementById("cnpjDuplicado").style.display="none";
  document.getElementById("successMsg").style.display="none";

  const cnpj = document.getElementById("cnpj").value.trim();
  const autoCadastro = document.getElementById("autoCadastro").value;
  const form = e.target;

  if(cnpj === "12345678000199"){ document.getElementById("cnpjDuplicado").style.display="block"; return; }
  if(!cnpjEhValido(cnpj)){ document.getElementById("cnpjInvalido").style.display="block"; return; }
  if(autoCadastro === "sim"){ document.getElementById("autoCadastroMsg").style.display="block"; }

  // Simulação local de sucesso
  const idFake = "PJ-" + Math.floor(Math.random()*900000 + 100000);
  document.getElementById("idRetorno").textContent = idFake;
  document.getElementById("successMsg").style.display="block";

  // Envia para backend real
  try { await postForm(form, 'http://localhost:8080/api/pessoas/juridica'); }
  catch(err){ console.error('Erro envio PJ', err); }

  form.reset();
});
</script>
</body>
</html>
