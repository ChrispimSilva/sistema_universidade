<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>Cadastro de Pessoa Física</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="topbar"><div class="title">Sistema Universidade</div></div>

  <main class="main">
    <section class="menu" aria-hidden="true">
      <div style="height:8px"></div>
    </section>

    <section class="formwrap">
      <a class="backbtn" href="index.html">
        <!-- back SVG -->
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M15 18l-6-6 6-6" stroke="#0b5586" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        Voltar
      </a>

      <div class="formcard">
        <h2>Cadastro de Pessoa Física</h2>

        <div id="erroCpf" class="message error">CPF já cadastrado. Você pode visualizar o cadastro existente ou cancelar.</div>
        <div id="erroCampos" class="message error">Existem campos inválidos ou faltando. Verifique os campos destacados.</div>
        <div id="successMsg" class="message success">Cadastro realizado com sucesso! ID: <span id="idRetorno"></span></div>

        <form id="formPF" method="POST" action="/api/pessoas/fisica" class="form-grid">

          <div class="full">
            <label class="field">Nome Completo *</label>
            <input class="input" name="nome" required placeholder="Insira seu nome completo...">
          </div>

          <div>
            <label class="field">CPF *</label>
            <input class="input" name="cpf" id="cpf" required placeholder="000.000.000-00">
          </div>

          <div>
            <label class="field">Data de Nascimento *</label>
            <div style="position:relative">
              <input class="input" type="date" name="dataNascimento" required>
            </div>
          </div>

          <div>
            <label class="field">Sexo *</label>
            <select class="input" name="sexo" required>
              <option value="">Selecione...</option>
              <option value="F">Feminino</option>
              <option value="M">Masculino</option>
              <option value="O">Outro</option>
            </select>
          </div>

          <div>
            <label class="field">E-mail *</label>
            <input class="input" type="email" name="email" required placeholder="Insira seu endereço de email...">
          </div>

          <div>
            <label class="field">Telefone *</label>
            <input class="input" name="telefone" required placeholder="(XX) XXXXX-XXXX">
          </div>

          <div>
            <label class="field">CEP *</label>
            <div class="cep-row">
              <input class="input" name="cep" placeholder="00000-000">
              <button type="button" class="cep-btn" id="btnCep" title="Buscar endereço">
                <!-- lupa svg -->
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35" stroke="#0b5586" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><circle cx="11" cy="11" r="6" stroke="#0b5586" stroke-width="1.6"/></svg>
                Buscar
              </button>
            </div>
          </div>

          <div class="full">
            <label class="field">Endereço Completo *</label>
            <textarea class="input" name="endereco" required placeholder="Insira seu endereço completo (ex: Rua, Avenida, etc...)"></textarea>
          </div>

          <div class="full">
            <label class="field">Documentos Complementares</label>
            <textarea class="input" name="documentos" placeholder="URLs ou observações"></textarea>
          </div>

          <div class="full">
            <button class="btn" type="submit">Salvar</button>
          </div>

        </form>
      </div>
    </section>
  </main>

  <footer class="footer">
	<div class="logo">
		<img src="https://www.ead.senac.br/public/assets/img/logo.png" 
			width="110" 
			height="32" 
			alt="Logo Senac">
	</div>
    <div class="credits">Equipe Projeto Integrador:<br>
		Anderson Chrispim da Silva<br>
		André Zicatti Leite<br>
		Diego Eiji de Menezes<br>
		Flavia R M Biagioni<br>
		Gustavo Lopes<br>
	</div>
  </footer>
  
<script src="form.js"></script>
<script>
// manter simulação + enviar para backend (postForm)
// handler adaptado para aguardar postForm antes do reset

document.getElementById("formPF").addEventListener("submit", async function(e){
    e.preventDefault();

    document.getElementById("erroCpf").style.display = "none";
    document.getElementById("erroCampos").style.display = "none";
    document.getElementById("successMsg").style.display = "none";

    const cpf = document.getElementById("cpf").value.trim();
    const form = e.target;

    // Cenário A1 — CPF duplicado (simulação)
    if(cpf === "11111111111"){
        document.getElementById("erroCpf").style.display = "block";
        return;
    }

    // Cenário A2 — validação de campos
    if(!form.checkValidity()){
        document.getElementById("erroCampos").style.display = "block";
        return;
    }

    // Simulação local de sucesso
    const idFake = "USR-" + Math.floor(Math.random() * 900000 + 100000);
    document.getElementById("idRetorno").textContent = idFake;
    document.getElementById("successMsg").style.display = "block";

    // Envia para backend real usando postForm (aguarda resposta)
    try {
      await postForm(form, 'http://localhost:8080/api/pessoas/fisica');
    } catch(err) {
      // se falhar, exibe erro (postForm já mostra alert)
      console.error('Erro no envio ao backend', err);
    }

    // limpa formulário após envio
    form.reset();
});
</script>
</body>
</html>
